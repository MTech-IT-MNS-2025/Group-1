{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/suraj/Desktop/1st_sem/ic3/pq-chat/pages/chat.js"],"sourcesContent":["// pages/chat.js\nimport { useEffect, useRef, useState } from \"react\";\nimport io from \"socket.io-client\";\nimport { useRouter } from \"next/router\";\n\nlet socket;\n\nexport default function ChatPage() {\n  const router = useRouter();\n  const [username, setUsername] = useState(\"\");\n  const [recipient, setRecipient] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n  const messagesRef = useRef([]);\n  const [connected, setConnected] = useState(false);\n\n  useEffect(() => {\n    const u = sessionStorage.getItem(\"username\");\n    if (!u) {\n      router.push(\"/\");\n      return;\n    }\n    setUsername(u);\n\n    // create socket\n    socket = io();\n    socket.on(\"connect\", () => {\n      console.log(\"socket connected\", socket.id);\n      setConnected(true);\n      socket.emit(\"register_user\", u);\n    });\n\n    socket.on(\"receive_message\", (payload) => {\n      // append incoming message\n      messagesRef.current = [...messagesRef.current, payload];\n      setMessages(messagesRef.current);\n    });\n\n    return () => {\n      if (socket) socket.disconnect();\n    };\n  }, []);\n\n  async function loadHistory() {\n    if (!recipient) return alert(\"Enter recipient username\");\n    const res = await fetch(`/api/messages?user1=${username}&user2=${recipient}`);\n    const history = await res.json();\n    messagesRef.current = history;\n    setMessages(history);\n  }\n\n  async function sendMessage() {\n    if (!recipient) return alert(\"Enter recipient username\");\n    if (!message) return;\n    const payload = {\n      sender: username,\n      receiver: recipient,\n      text: message,\n      timestamp: new Date().toISOString()\n    };\n    // emit\n    socket.emit(\"send_message\", payload);\n    // locally append\n    messagesRef.current = [...messagesRef.current, payload];\n    setMessages(messagesRef.current);\n    setMessage(\"\");\n  }\n\n  return (\n    <div style={{ maxWidth: 900, margin: \"1rem auto\", padding: 20 }}>\n      <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n        <h2>Chat — {username} {connected ? \"(online)\" : \"(connecting...)\"}</h2>\n        <button onClick={() => { sessionStorage.removeItem(\"username\"); router.push(\"/\"); }}>Logout</button>\n      </div>\n\n      <div style={{ marginTop: 10 }}>\n        <input placeholder=\"recipient username\" value={recipient} onChange={(e) => setRecipient(e.target.value)} />\n        <button onClick={loadHistory} style={{ marginLeft: 8 }}>Load History</button>\n      </div>\n\n      <div style={{ marginTop: 20, minHeight: 300, border: \"1px solid #ccc\", padding: 10, overflowY: \"auto\" }}>\n        {messages.map((m, idx) => (\n          <div key={idx} style={{ marginBottom: 10, textAlign: m.sender === username ? \"right\" : \"left\" }}>\n            <div style={{ fontSize: 12, color: \"#666\" }}>{m.sender} • {new Date(m.timestamp).toLocaleString()}</div>\n            <div style={{ display: \"inline-block\", marginTop: 4, padding: \"8px 12px\", borderRadius: 8, background: m.sender === username ? \"#d1ffd6\" : \"#eee\" }}>\n              {m.text || \"[encrypted message]\"}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <div style={{ marginTop: 10 }}>\n        <input placeholder=\"Type a message...\" value={message} onChange={(e) => setMessage(e.target.value)} style={{ width: \"70%\" }} />\n        <button onClick={sendMessage} style={{ marginLeft: 8 }}>Send</button>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}